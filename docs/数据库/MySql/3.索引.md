# 索引

索引是一种用于快速查询和检索的数据结构，本质是一种排序好的数据结构。

## 索引常见模型
1. 哈希表，将key换算成一个确定的位置，然后把value放在数组的这个位置上，多个key一致时，拉出一个链表存储。
2. 有序数组：有序顺组存储有序的key，用二分法查找，支持范围查找。
3. 搜索树（二叉搜索树）：

索引底层数据存在多种类型：
1. Hash
2. B树
3. B+树（Innodb和MyISAM都使用） 
4. 红黑树

使用索引的优点：
1. 大大加快数据检索速度
2. 通过唯一性索引，可以保证数据的唯一性

使用索引的缺点：
1. 创建和维护索引都需要消耗事件。数据变更时，索引会同步进行修改。
2. 索引会占用物理存储空间。

## 索引的底层数据结构

### Hash表

Hash表将数据计算出key对应的index，关联到数据Value值，检索速度为O(1)，Hash表有个Hash冲突的问题，通常解决办法时链地址法，为了避免链地址过长，到达一定长度转换为红黑树。

Hash表无法进行顺序查询和范围查询，所以不常使用Hash表索引。

### B树和B+树

B树也称为B-树，全称为多路平衡查询树，B+树是Ｂ树的一个变体，大部分数据库都使用Ｂ树作为索引数据结构。

B树和B＋树两者异同？
1. B树的所有节点即存放键(key)也存放数据(data)，而B+树只有叶子节点存放key和data，其他内节点只存放key。
2. B树的叶子节点都是独立的，B+树的叶子节点有一条引用链条指向与他相邻的叶子节点，方便进行范围查询。
3. B树的检索过程相当于对范围内的每个节点的关键字进行二分查找，可能还没有到达叶子节点，检索就结束；B+树检索效率就很稳定，任何查找都是从根节点到叶子节点的过程，叶子节点的顺序检索很明显。

MySQL中，MyISAM引擎和InnoDB引擎都使用B+树作为索引结构，单实现方式不一样：
1. MyISAM中，B+树叶节点的data域存放的是数据记录的地址。在查询时，首先按照B+树搜索算法搜索索引，如果指定的key存在，则取出data域的值，然后以data域的值为地址读取相应的数据记录。称为非聚簇索引。
2. InnoDB引擎中，数据文件本身就是索引文件，表数据文件本身就是按B+树组织的一个索引结构，树的叶节点data域保存完整的数据记录。索引的key是数据表的主键，InnoDB表数据文件本身就是主索引，称为聚簇索引。
3. 其他的都作为辅助索引，辅助索引的data域存储相应记录主键的值而不是地址。在设计表时，不建议使用过长的字段作为主键，也不建议使用非单调的字段作为主键，会造成主索引频繁分裂。

## 索引类型
### 主键索引

数据表的主键使用的索引就是主键索引。InnoDB中，如果没有显式的指定主键时，会自动先检查是否有唯一索引且不允许存在null值的字段，如果有，则选为主键索引，否则会自动创建一个64Byte的自增主键。

### 二级索引（辅助索引）

二级索引的叶子节点存储的是主键，也就是可以通过二级索引，定位主键的位置。

1. 唯一索引：唯一索引的列不允许出现重复的数据，但允许数据为null，一张表允许多个唯一索引，大多是为了数据的唯一性，而不是为了查询速度。
2. 普通索引：普通索引的目的就是为了快速查询数据，允许数据重复和null
3. 前缀索引：适用于字符串型数据，是对文本前几个字符创建索引。
4. 全文索引：为了检索大文本数据中的关键字信息，是目前搜索引擎数据库的一种技术。
5. 聚簇索引：索引结构和数据一起存放的索引，并不是一种单独的索引类型。
6. 非聚簇索引：索引结构和数据分开存放的索引，二级索引都数据非聚簇索引。
7. 覆盖索引：一个索引包含所有需要查询的字段，就称为覆盖索引，可以避免回表查询数据。
8. 联合索引：使用表中多个字段创建索引，就是联合索引。
9. 索引下推：在非聚簇索引遍历过程中，对索引中包含的的字段先做判断，过滤掉不符合条件的记录，减少回表次数。

### 正确使用索引的建议：
1. 选择合适的字段创建索引
  - 不为null的字段：难以优化
  - 被频繁查询的字段
  - 被作为条件查询的字段
  - 频繁需要排序的字段
  - 被经常频繁用于链接的字段
2. 被频繁更新的字段应该慎重建立索引
3. 尽可能考虑建立联合索引而不是单列索引
4. 注意避免冗余索引
5. 考虑在字符串类型上使用前缀索引代替普通索引
6. 避免索引失效
  - 使用select * 进行查询
  - 创建了联合索引，但查询条件未遵守最左匹配原则
  - 在索引上进行计算，函数，类型转换等操作
  - 以%开头的like查询
  - 查询条件中使用or，且or的前后条件中有一个列没有索引
  - 发生隐式转换
7. 删除长期未使用的索引


https://javaguide.cn/database/mysql/mysql-index.html#b-%E6%A0%91-b-%E6%A0%91


# 事务隔离级别

## 基础知识

### ACID：
1. 原子性：一个事务内的操作要么都成功，要么都失败
2. 一致性：数据库从一个状态到达另一个状态
3. 持久性：已经提交的数据不会再丢失
3. 隔离性：一个事务的操作不会影响另一个事务的执行

### 隔离级别：
1. 读未提交：一个事务还没有提交的数据，别的事务就可以看到
2. 读已提交：一个事务提交之后，所作的变更才能被其他事务看到
3. 可重复读：一个事务执行过程中看到的事务，总是和事务启动时看到的一致
4. 序列化：一个事务一个事务的串行执行

### 隔离级别存在的问题：
1. 脏读：读取了其他事务未提交的数据
2. 不可重复读：多次读取到不一致的数据
3. 幻读：读取到的数据发生了增加或减少

### 隔离级别存在的问题
问题|脏读|不可重复度|幻读
-|-|-|-
读未提交|X|X|X
读已提交||X|X
可重复读|||X
串行化|||

### MySQL中的隔离级别
myslq InnoDB默认级别为 可重复读，标准可重复度无法防止幻读。

InnoDB在可重复度级别解决幻读依靠以下技术：
1. 快照读：由MVCC机制保证不出现幻读
2. 当前读：使用Next-key Lock进行加锁保证不出现幻读，Next-Key Lock是行锁（Record Lock）和间隙锁（Gap Lock）的结合，行锁只能锁住已存在的行，避免插入新值，需要依赖间隙锁

## 事务隔离的实现

在MySQL中，可重复读隔离级别，每条记录在更新时都会同时记录一条回滚操作。记录上的最新值，通过回滚操作，都可以得到前一个状态的值（MVCC）。

## 事务的启动方式
1. 显式启动：begin或start transation，commit，rollback
2. set autocommit=0，会将这个线程的自动提交关掉，事务持续直到主动commit或rollback，或者断开连接。




https://javaguide.cn/database/mysql/transaction-isolation-level.html
# 计算机网络

> 3次握手描述
1. A-B:SYN=1,Seq=X
2. B-A:SYN=1,Seq=Y,Ack=X+1,ACK=1
3. A-B:      Seq=X+1,Ack=Y+1,ACK=1

注:
1. SYN:控制位
2. Seq:请求序列号
2. Ack:确认序列号
3. ACK:确认标志位


> 4次挥手描述
1. A-B:发送FIN和ACK报文
2. B-A:发送ACK报文,
3. B-A:发送FIN和ACK报文
3. A-B:发送ACK报文

> 三次握手和四次挥手的本质:

三次握手的本质是确认通信双方收发数据的能力.
四次挥手的目的是关闭一个连接

> TCP连接时是3次,2次不可以吗?

握手2次,第二次握手时如果服务端发送给客户端的确认报文丢失,此时服务端已准备给客户端发送报文,客户端一直没收到客户端的确认报文,客户端就不知道服务端是否已经准备好了,这时客户端不会给服务端发送数据,也会忽略服务端发来的数据.

> 为什么连接的时候是3次,关闭时候是4次

只有在客户端和服务端都在没有数据要发送的时候才断开TCP,客户端发出FIN报文只能保证客户端没有数据了,服务端有没有数据,客户端不知道.

> 为什么客户端发出第四次挥手的确认报文后要等2MSL的时间才释放连接

MSL指的是一段TCP报文在传输过程中的最大生命周期.2MSL是服务器发出为FIN报文和客户端发出的ACK确认报文所能保持有效的最大时长.
同样是考虑丢包的问题,如果第四次挥手报文丢失,服务端没收到确认ack报文会重发第三次挥手报文,这样一来一去,就是2MSL.等这么长时间来确认服务端确实收到了

> 如果已经建立了连接,但是客户端突然出现了故障怎么办

TCP有一个保活计时器,客户端出现故障.为2小时,每次请求会刷新计时器,若2小时没有收到任何数据,服务器会发送探测报文,每75秒发送一次,一连发送10个探测报文任没有反应,然后关闭连接.



